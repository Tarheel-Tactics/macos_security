{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "macOS Security Compliance Project Rule",
    "description": "Schema for a macOS Security Compliance Project rule, detailing security configurations and requirements for Apple platforms.",
    "version": "2.0.0",
    "required": [
        "id",
        "title",
        "discussion",
        "references",
        "platforms"
    ],
    "additionalProperties": false,
    "properties": {
        "id": {
            "description": "Unique identifier for each rule. The filename for the rule should match this id",
            "type": "string"
        },
        "title": {
            "description": "Title of the rule as it will appear in the documentation",
            "type": "string"
        },
        "discussion": {
            "description": "The discussion may contain a description of the rule, rationale, or other information that will appear in the generated documentation",
            "type": "string"
        },
        "tags": {
            "description": "Metadata keywords used for searching for rules and for cross-referencing.",
            "$ref": "#/components/schemas/ArrayOfStrings",
            "minimumitems": 1
        },
        "odv": {
            "description": "Organization Defined Values are determined by a benchmark or customized by the organization.",
            "type": "object",
            "properties": {
                "hint": {
                    "type": "object",
                    "properties": {
                        "datatype": {
                            "type": "string"
                        },
                        "description": {
                            "type": "string"
                        },
                        "validation": {
                            "type": "object",
                            "properties": {
                                "min": {
                                    "type": "number"
                                },
                                "max": {
                                    "type": "number"
                                },
                                "regex": {
                                    "type": "string"
                                },
                                "enumValues": {
                                    "$ref": "#/components/schemas/ArrayOfStrings"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "required": [
                        "description"
                    ],
                    "additionalProperties": false
                },
                "recommended": {
                    "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
                }
            },
            "required": [
                "hint",
                "recommended"
            ],
            "additionalProperties": true
        },
        "references": {
            "description": "Identifiers used to cross-reference other published security documentation as it relates to MSCP controls",
            "type": "object",
            "properties": {
                "nist": {
                    "type": "object",
                    "properties": {
                        "cce": {
                            "type": "object",
                            "additionalProperties": {
                                "$ref": "#/components/schemas/ArrayOfStrings"
                            }
                        },
                        "800-53r5": {
                            "$ref": "#/components/schemas/ArrayOfStrings"
                        },
                        "800-171r3": {
                            "$ref": "#/components/schemas/ArrayOfStrings"
                        }
                    },
                    "required": [
                        "cce"
                    ]
                },
                "disa": {
                    "type": "object",
                    "properties": {
                        "cci": {
                            "$ref": "#/components/schemas/ArrayOfStrings"
                        },
                        "srg": {
                            "$ref": "#/components/schemas/ArrayOfStrings"
                        },
                        "disa_stig": {
                            "type": "object",
                            "additionalProperties": {
                                "$ref": "#/components/schemas/ArrayOfStrings"
                            }
                        }
                    }
                },
                "cmmc": {
                    "$ref": "#/components/schemas/ArrayOfStrings"
                },
                "cis": {
                    "type": "object",
                    "properties": {
                        "benchmark": {
                            "type": "object",
                            "additionalProperties": {
                                "$ref": "#/components/schemas/ArrayOfStrings"
                            }
                        },
                        "controls_v8": {
                            "type": "array",
                            "items": {
                                "anyOf": [
                                    {
                                        "type": "string"
                                    },
                                    {
                                        "type": "number"
                                    }
                                ]
                            }
                        }
                    }
                },
                "bsi": {
                    "type": "object",
                    "properties": {
                        "indigo": {
                            "type": "object",
                            "additionalProperties": {
                                "$ref": "#/components/schemas/ArrayOfStrings"
                            }
                        }
                    }
                }
            },
            "required": [
                "nist"
            ],
            "additionalProperties": true
        },
        "platforms": {
            "type": "object",
            "properties": {
                "macOS": {
                    "type": "object",
                    "description": "Schema for identifying components to support macOS",
                    "properties": {
                        "check": {
                            "type": "string"
                        },
                        "result": {
                            "type": "object",
                            "properties": {
                                "string": {
                                    "type": "string"
                                },
                                "integer": {
                                    "anyOf": [
                                        {
                                            "type": "integer"
                                        },
                                        {
                                            "type": "string",
                                            "enum": [
                                                "$ODV"
                                            ]
                                        }
                                    ]
                                },
                                "boolean": {
                                    "type": "boolean"
                                }
                            }
                        },
                        "fix": {
                            "description": "Command to fix the issue if the check command fails.",
                            "type": "string"
                        },
                        "13.0": {
                            "$ref": "#/$defs/osDef"
                        },
                        "14.0": {
                            "$ref": "#/$defs/osDef"
                        },
                        "15.0": {
                            "$ref": "#/$defs/osDef"
                        },
                        "introduced": {
                            "type": "string"
                        },
                        "additionalProperties": false
                    }
                },
                "iOS": {
                    "type": "object",
                    "description": "Schema for identifying components to support iOS",
                    "properties": {
                        "16.0": {
                            "type": "object",
                            "properties": {
                                "$ref": "#/$defs/osDef",
                                "supervised": {
                                    "type": "boolean"
                                }
                            }
                        },
                        "17.0": {
                            "type": "object",
                            "properties": {
                                "$ref": "#/$defs/osDef",
                                "supervised": {
                                    "type": "boolean"
                                }
                            }
                        },
                        "18.0": {
                            "type": "object",
                            "properties": {
                                "$ref": "#/$defs/osDef",
                                "supervised": {
                                    "type": "boolean"
                                }
                            }
                        },
                        "introduced": {
                            "type": "string"
                        },
                        "additionalProperties": false
                    }
                },
                "visionOS": {
                    "type": "object",
                    "description": "Schema for identifying components to support visionOS",
                    "properties": {
                        "2.0": {
                            "type": "object",
                            "properties": {
                                "$ref": "#/$defs/osDef",
                                "supervised": {
                                    "type": "boolean"
                                }
                            }
                        },
                        "introduced": {
                            "type": "string"
                        },
                        "additionalProperties": false
                    }
                }
            }
        },
        "mobileconfig_info": {
            "type": "array",
            "description": "Definition for supported Mobile Device Management configurations",
            "items": {
                "type": "object",
                "properties": {
                    "PayloadType": {
                        "type": "string"
                    },
                    "PayloadContent": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "additionalProperties": {
                                "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
                            }
                        }
                    }
                },
                "required": [
                    "PayloadType",
                    "PayloadContent"
                ],
                "additionalProperties": false
            }
        },
        "ddm_info": {
            "type": "object",
            "description": "Definition for supported Declarative Device Management components",
            "properties": {
                "declarationtype": {
                    "type": "string",
                    "enum": [
                        "com.apple.configuration.services.configuration-files",
                        "com.apple.configuration.diskmanagement.settings",
                        "com.apple.configuration.passcode.settings"
                    ]
                },
                "service": {
                    "type": "string",
                    "enum": [
                        "com.apple.sshd",
                        "com.apple.sudo",
                        "com.apple.pam",
                        "com.apple.cups",
                        "com.apple.apache.httpd",
                        "com.apple.bash",
                        "com.apple.zsh"
                    ]
                },
                "config_file": {
                    "type": "string"
                },
                "configuration_key": {
                    "type": "string"
                },
                "configuration_value": {
                    "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
                },
                "ddm_key": {
                    "type": "string"
                },
                "ddm_value": {
                    "$ref": "#/components/schemas/AnyofStringIntegerBooleanArrayObject"
                },
                "if": {
                    "properties": {
                        "declaration_type": {
                            "const": "com.apple.configuration.services.configuration-files"
                        }
                    }
                },
                "then": {
                    "required": [
                        "service",
                        "config_file",
                        "configuration_value",
                        "configuration_key"
                    ]
                },
                "else": {
                    "required": [
                        "declaration_type",
                        "ddm_key",
                        "ddm_value"
                    ]
                },
                "additionalProperties": false
            }
        }
    },
    "components": {
        "schemas": {
            "ArrayOfStrings": {
                "type": "array",
                "items": {
                    "type": "string"
                }
            },
            "AnyofStringIntegerBooleanArrayObject": {
                "anyOf": [
                    {
                        "type": "string"
                    },
                    {
                        "type": "integer"
                    },
                    {
                        "type": "boolean"
                    },
                    {
                        "type": "array",
                        "$ref": "#/components/schemas/ArrayOfStrings"
                    },
                    {
                        "type": "object",
                        "additionalProperties": true
                    }
                ]
            }
        }
    },
    "$defs": {
        "osDef": {
            "type": "object",
            "description": "Operating System Definition",
            "properties": {
                "severity": {
                    "description": "Severity level of the issue, typically defined in a benchmark.",
                    "type": "string"
                },
                "benchmarks": {
                    "$ref": "#/components/schemas/ArrayOfStrings"
                },
                "fix": {
                    "description": "Bash command(s) to fix the issue if the check command fails.",
                    "type": "string"
                }
            }
        }
    }
}